---
title: 《计算机程序的构造和解释》(sicp) chap-3.2
date: 2019/10/19 23:20:00
categories:
- [读书笔记, sicp]
tags:
- sicp
- 读书笔记
---
&emsp;&emsp;程序引入**赋值**概念后，程序运行的复杂性大大增强。其复杂性不单单体现在代码执行顺序的执行上，赋值的引用，环境模型，模块设计与代换模型都与之前大不相同，这一章我们需要掌握赋值概念下产生的**环境**的程序结构概念，并了解**环境**结构下，变量独特的访问规则。
<!--more-->

&emsp;&emsp;引入赋值的概念之后，变量的意义发生巨大的改变。因为变量可以被随时的赋值和改变各种数据格式形态，变量不单单指代一个具体的结果，而应该看为一个类似容器的概念，可以随时的**放入**和**取出**值的一个容器。而在新的代换模型中，这种读取容器运行的过程运行在被称为**环境**的一种结构中。

&emsp;&emsp;来举一个简单的实例，我们声明一个简单的求平方的函数square，放入x，返回x的平方。`(define (square x) (* x x))`。其实这种定义函数的本质为定义了一个变量`square`，然后把它赋值为一个函数。写法其实等同于`(define square (lambda (x) (* x x)))`。写法二中我们可以很直观的感觉到，定义`square`并且把一个lambda的运行过程赋予它。接着我们定义一个变量，然后运行它：
```scheme
;; 定义square为乘方函数
(define square
    (lambda (x) (* x x)))
;; 定义变量a为10
(define a 10)
;; 运行square
(square a)
```
&emsp;&emsp;在上面的过程中，我们把整个过程理解为一个**全局环境**，在全局环境中，我们定义了两个变量`square`和`a`。在最后一步运行`square`过程中，实质上构建起了一个**局部运行环境**，我们在局部运行环境中定义了一个名为`x`的变量，然后把取出全局环境中变量`a`的值10，赋予了`x`，然后运算求`x`的平方。可以看到，在这个局部环境中，我们可以定义**局部环境的变量**，也可以访问到**全局环境**中的一些变量。在引入赋值概念后，这个环境与变量的层级关系就显得尤为重要。因为我们需要知道，我们赋值改变的底是哪个变量。

```scheme
(define a 10)
(define (change-value)
    (set! a 20))
(define (change-value-mode2)
    (let ((a 10)) (set! a 30))
)
(display a) ;; 10
(change-value)
(display a) ;; 20
(change-value-mode2)
(display a) ;; 20
```

&emsp;&emsp;我们定义了两个赋值函数`change-value`以及`change-value-mode2`,均对变量`a`进行了赋值。不同的是`change-value-mode2`在自己的局部环境内部定义了一个变量`a`。我们可以看到运行`change-value`时，变量`a`如预期变为了20.但是调用`change-value-mode2`之后，`a`没有成功被赋值改变，因为`change-value-mode2`的局部环境中已经找到了变量`a`，直接对局部环境中的变量`a`进行了操作。

&emsp;&emsp;我们可以把全局环境想象为一个大房间，每一个函数形成的局部环境想成一个个小房间。在函数运行过程中,会现在自己的小房间查找所需要的变量和值，在找不到的情况下会往外部去寻找。在实际代码过程中，函数可以再嵌套函数，形成局部环境中的局部环境。此时外部的局部环境，对于内部局部环境也是可以访问的。

```
------------- 全局 --------------
               a
---------------------------------
               |          a
change-value   |   change-value-mode2
```

&emsp;&emsp;平行的局部环境。相互之间并不能访问改变到对方环境中存在的变量。这也是面向对象编程的编程`多态`概念能够存在的原理。每个对象是一个保存了各种所需值的**局部环境**，通过访问**全局环境**中共有的方法，对自身局部环境中的变量值进行操作计算。

&emsp;&emsp;赋值概念的引入，使得变量的含义拓展为变为一个可供存取的容器，一个指向存储环境的地址。程序运行的过程产生了**环境**的结构概念，也使得原来在不赋值情况下代换模型产生了变更，形成了环境嵌套，内部访问外部，同级局部之间互相独立的程序模型。在这种程序模型下产生了独特的程序设计思想，面向对象就是其中一个成熟的例子。